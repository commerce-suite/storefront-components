{"version":3,"names":["LiveShopHandler","getProducts","productIds","this","liveShopData","products","map","product","productId","ProductService","getList","fields","filter","page","first","agg","field","getLiveShop","hashRoom","LiveShopService","getByHash","groupByProductIdWithColorAndVariations","edges","grouped","node","colorId","_b","_a","color","id","push","Object","fromEntries","entries","colorGroups","values","selectBaseNode","nodes","find","n","images","length","buildProductItemGroupedByColor","base","liveProduct","validColorGroups","group","shouldGroup","colors","variation","name","slug","_c","hexadecimal","_d","image","_f","_e","src","price","productImage","_h","_g","balance","reduce","sum","v","priceCompare","variations","gridId","assign","seenSrcs","Set","result","flat","variationId","has","add","priceBase","isSellOutOfStock","type","show","status","highlight","position","showStartingFrom","hasPriceRange","productsToItemsAdapter","liveProducts","allNodes","baseNode","p","Number","messagesToItemsAdapter","messages","message","title","content","updateItems","items","maxPosition","Math","max","i","updatedItems","item","isHighlightOn","wasHighlightOn","isHidden","lastPosition","undefined","sort","a","b","getItems","productItems","messageItems","allItems","WebSocketClient","constructor","url","socket","reconnectAttempts","reconnectTimeout","messageCallback","onOpen","addEventListener","onClose","event","wasClean","handleReconnect","onError","connect","onclose","onerror","onmessage","WebSocket","onopen","MAX_RECONNECT_ATTEMPTS","delay","INITIAL_INCREMENT_DELAY","min","INITIAL_RECONNECT_DELAY","pow","MAX_RECONNECT_DELAY","window","setTimeout","closeConnection","readyState","OPEN","close","clearTimeout","onMessage","callback","liveShopCss","LiveShopStyle0","LiveShop","handleResize","isSmallDevice","innerWidth","isChatOpenHandler","isChatOpen","handleMessage","data","JSON","parse","statusMap","liveOn","liveOff","liveShopRegister","liveShopItems","liveShopItemsService","error","console","disconnectedCallback","removeEventListener","liveSocket","componentDidLoad","Error","isLoading","componentRendered","emit","videoId","extractYouTubeVideoId","urlLive","wsBaseUrl","Env","WEBSOCKET_URL","includes","liveShopNotFound","renderLoading","h","class","renderWarmup","customClass","cardTitle","banner","alt","renderInLive","toggleChat","renderFinished","cardDescription","onClick","onReturnToHome","render","Host"],"sources":["src/components/live-shop/services/live-shop.service.ts","src/services/WebSocketClient.ts","src/components/live-shop/live-shop.scss?tag=live-shop","src/components/live-shop/live-shop.tsx"],"sourcesContent":["import { LiveShopService, ProductService } from '@uxshop/storefront-core';\nimport {\n  LiveShop,\n  LiveShopProduct,\n} from '@uxshop/storefront-core/dist/modules/live-shop/LiveShopTypes';\nimport { IHighlightCardItem } from '../../../components';\nimport { IMessageItem, IProductItem } from '../../ui/highlight-card/highlight-card.type';\nimport { SocketMessage } from '../live-shop.type';\nimport { Product } from '@uxshop/storefront-core/dist/modules/product/ProductTypes';\n\nexport class LiveShopHandler {\n  private liveShopData: LiveShop;\n\n  private async getProducts() {\n    const productIds = this.liveShopData.products.map(product => product.productId);\n    return await ProductService.getList({\n      fields: [\n        'id',\n        'name',\n        'images { src }',\n        'price',\n        'priceCompare',\n        'productId',\n        'slug',\n        'hasPriceRange',\n        'balance',\n        'isSellOutOfStock',\n        'color { id, name, hexadecimal, slug, image { src } }',\n      ],\n      filter: { productIds, page: 0, first: 1000 },\n      agg: {\n        field: ['productId', 'colorId', 'id'],\n      },\n    });\n  }\n\n  public async getLiveShop(hashRoom: string): Promise<LiveShop> {\n    this.liveShopData = await LiveShopService.getByHash(hashRoom);\n    return this.liveShopData;\n  }\n\n  private groupByProductIdWithColorAndVariations(\n    edges: { node: Product }[],\n  ): Record<number, Product[][]> {\n    const grouped: Record<number, Record<number, Product[]>> = {};\n\n    for (const { node } of edges) {\n      const productId = node.productId;\n      const colorId = node.color?.id ?? 0;\n\n      if (!grouped[productId]) grouped[productId] = {};\n      if (!grouped[productId][colorId]) grouped[productId][colorId] = [];\n\n      grouped[productId][colorId].push(node);\n    }\n\n    return Object.fromEntries(\n      Object.entries(grouped).map(([productId, colorGroups]) => [\n        +productId,\n        Object.values(colorGroups),\n      ]),\n    );\n  }\n\n  private selectBaseNode(nodes: Product[]) {\n    return nodes.find(n => n.images?.length) ?? nodes[0];\n  }\n\n  private buildProductItemGroupedByColor(\n    base: Product,\n    colorGroups: Product[][],\n    liveProduct: LiveShopProduct,\n  ): IProductItem {\n    const validColorGroups = colorGroups.filter(group => group[0]?.color?.id);\n\n    const shouldGroup = validColorGroups.length > 1;\n\n    const colors = shouldGroup\n      ? validColorGroups.map(group => {\n          const variation = group[0];\n          return {\n            id: variation.color?.id,\n            name: variation.color?.name,\n            slug: variation.color?.slug,\n            hexadecimal: variation.color?.hexadecimal,\n            image: variation.color?.image?.src ? { src: variation.color.image.src } : null,\n            price: variation.price,\n            productImage: variation.images?.[0]?.src ? { src: variation.images[0].src } : null,\n            balance: group.reduce((sum, v) => sum + (v.balance ?? 0), 0),\n            priceCompare: variation.priceCompare,\n            variations: group.map(v => ({\n              id: v.id,\n              price: v.price,\n              balance: v.balance,\n              image: v.images?.[0]?.src ? { src: v.images[0].src } : null,\n            })),\n          };\n        })\n      : null;\n\n    const color = base.color;\n    const gridId = color ? `${base.productId}-${color.id}` : `${base.productId}`;\n\n    return {\n      id: +base.productId,\n      name: base.name,\n      image: base.images?.[0]?.src ? { src: base.images[0].src } : null,\n      images: (() => {\n        const seenSrcs = new Set<string>();\n        const result: { src: string; variationId: string }[] = [];\n\n        for (const variation of colorGroups.flat()) {\n          const variationId = variation.id;\n          const images = variation.images ?? [];\n\n          for (const image of images) {\n            if (image?.src && !seenSrcs.has(image.src)) {\n              seenSrcs.add(image.src);\n              result.push({\n                src: image.src,\n                variationId,\n              });\n            }\n          }\n        }\n\n        return result;\n      })(),\n      price: base.price,\n      priceBase: base.priceCompare,\n      balance: base.balance,\n      isSellOutOfStock: base.isSellOutOfStock,\n      gridId,\n      slug: base.slug,\n      type: 'product',\n      show: liveProduct?.status && liveProduct.status !== 'hidden',\n      highlight: liveProduct?.status === 'highlighting',\n      position: liveProduct?.position ?? 0,\n      colors,\n      ...(shouldGroup ? {} : { showStartingFrom: base.hasPriceRange }),\n    };\n  }\n\n  private async productsToItemsAdapter(): Promise<IProductItem[]> {\n    const products = await this.getProducts();\n    const liveProducts = this.liveShopData?.products;\n\n    const grouped = this.groupByProductIdWithColorAndVariations(products.edges);\n\n    return Object.entries(grouped).map(([productId, colorGroups]) => {\n      const allNodes = colorGroups.flat();\n      const baseNode = this.selectBaseNode(allNodes);\n      const liveProduct = liveProducts.find(p => p.productId === Number(productId));\n\n      return this.buildProductItemGroupedByColor(baseNode, colorGroups, liveProduct);\n    });\n  }\n\n  private messagesToItemsAdapter(): IMessageItem[] {\n    return this.liveShopData.messages.map(message => ({\n      id: message.id ?? null,\n      title: message.title,\n      content: message.content,\n      type: 'message',\n      show: message.status && message.status !== 'hidden',\n      highlight: message.status === 'highlighting',\n      position: message.position ?? 0,\n    }));\n  }\n\n  public updateItems(items: IHighlightCardItem[], message: SocketMessage): IHighlightCardItem[] {\n    const maxPosition = Math.max(...items.map(i => i.position ?? 0));\n\n    const updatedItems = items.map(item => {\n      if (item.id !== message.id || item.type !== message.type) return item;\n\n      const isHighlightOn = message.status === 'highlighting';\n      const wasHighlightOn = !!item.highlight;\n      const isHidden = message.status === 'hidden';\n\n      if (isHighlightOn && !wasHighlightOn) {\n        return {\n          ...item,\n          show: !isHidden,\n          highlight: true,\n          lastPosition: item.lastPosition ?? item.position,\n          position: maxPosition + 1,\n        };\n      }\n\n      if (!isHighlightOn && wasHighlightOn) {\n        return {\n          ...item,\n          show: !isHidden,\n          highlight: false,\n          position: item.lastPosition ?? item.position,\n          lastPosition: undefined,\n        };\n      }\n\n      return {\n        ...item,\n        show: !isHidden,\n        highlight: isHighlightOn,\n        position: maxPosition + 1,\n      };\n    });\n\n    updatedItems.sort((a, b) => (b.position ?? 0) - (a.position ?? 0));\n    return updatedItems;\n  }\n\n  public async getItems(): Promise<IHighlightCardItem[]> {\n    const productItems = await this.productsToItemsAdapter();\n    const messageItems = this.messagesToItemsAdapter();\n\n    const allItems = [...productItems, ...messageItems];\n\n    allItems.sort((a, b) => b.position - a.position);\n\n    return allItems;\n  }\n}\n","export class WebSocketClient {\n  private static readonly MAX_RECONNECT_ATTEMPTS = 5;\n  private static readonly INITIAL_RECONNECT_DELAY = 5000;\n  private static readonly MAX_RECONNECT_DELAY = 30000;\n  private static readonly INITIAL_INCREMENT_DELAY = 1000;\n\n  private socket: WebSocket | null = null;\n  private reconnectAttempts = 0;\n  private reconnectTimeout: number | null = null;\n  private url: string;\n  private messageCallback: ((event: MessageEvent) => void) | null = null;\n\n  constructor(url: string) {\n    this.url = url;\n    this.connect();\n  }\n\n  private connect() {\n    if (this.socket) {\n      this.socket.onclose = null;\n      this.socket.onerror = null;\n      this.socket.onmessage = null;\n    }\n\n    this.socket = new WebSocket(this.url);\n\n    this.socket.onopen = this.onOpen;\n    this.socket.onclose = this.onClose;\n    this.socket.onerror = this.onError;\n  }\n\n  private onOpen = () => {\n    this.reconnectAttempts = 0;\n\n    if (this.messageCallback && this.socket) {\n      this.socket.addEventListener('message', this.messageCallback);\n    }\n  };\n\n  public onClose = (event: CloseEvent) => {\n    if (!event.wasClean) this.handleReconnect();\n  };\n\n  private onError = () => {\n    this.handleReconnect();\n  };\n\n  private handleReconnect() {\n    if (this.reconnectTimeout !== null) return;\n\n    if (this.reconnectAttempts >= WebSocketClient.MAX_RECONNECT_ATTEMPTS) return;\n\n    const delay =\n      this.reconnectAttempts === 0\n        ? WebSocketClient.INITIAL_INCREMENT_DELAY\n        : Math.min(\n            WebSocketClient.INITIAL_RECONNECT_DELAY * Math.pow(2, this.reconnectAttempts - 1),\n            WebSocketClient.MAX_RECONNECT_DELAY,\n          );\n\n    this.reconnectTimeout = window.setTimeout(() => {\n      this.reconnectAttempts++;\n      this.reconnectTimeout = null;\n      this.connect();\n    }, delay);\n  }\n\n  public closeConnection() {\n    if (this.socket?.readyState === WebSocket.OPEN) {\n      this.socket.close();\n    }\n    if (this.reconnectTimeout !== null) {\n      clearTimeout(this.reconnectTimeout);\n      this.reconnectTimeout = null;\n    }\n  }\n\n  public onMessage(callback: (event: MessageEvent) => void) {\n    this.messageCallback = callback;\n    if (this.socket) {\n      this.socket.addEventListener('message', callback);\n    }\n  }\n}\n","@import '../../style/mixins/button.scss';\n@import '../../style/mixins/spinner-loading.scss';\n\n:host {\n  display: block;\n  width: 100%;\n}\n\n.loading-container {\n  display: flex;\n  width: 100%;\n  justify-content: center;\n  align-items: center;\n  min-height: 350px;\n\n  .spinner {\n    @include lds-dual-ring;\n  }\n}\n\n.live-shop {\n  &-warmup {\n    .banner-custom-style {\n      padding: 40px;\n\n      > .custom-card-content {\n        width: 100%;\n        max-width: 720px;\n        height: auto;\n        aspect-ratio: 16 / 9;\n\n        & img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        }\n\n        .live-shop-banner {\n          background-color: #d9d9d9;\n          height: 100%;\n          width: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n      }\n    }\n  }\n\n  &-finished {\n    .button-custom-style {\n      padding: 40px;\n      max-width: 410px;\n      margin: 0 auto;\n      text-align: center;\n\n      & button {\n        @include front-button;\n        font-weight: 500;\n        font-size: 14px;\n      }\n    }\n  }\n}\n","import { Component, Event, Host, EventEmitter, h, State, Prop, Env } from '@stencil/core';\nimport { ILiveShop, SocketMessage } from './live-shop.type';\nimport { IHighlightCardItem } from '../../components';\nimport { LiveShopHandler } from './services/live-shop.service';\nimport { WebSocketClient } from '../../services/WebSocketClient';\nimport { extractYouTubeVideoId } from '../../utils/utils';\n\n@Component({\n  tag: 'live-shop',\n  styleUrl: 'live-shop.scss',\n  shadow: false,\n})\nexport class LiveShop {\n  @Prop() hashRoom: string;\n  @State() liveShopNotFound: boolean = false;\n  @State() videoId: string;\n  @State() isSmallDevice: boolean = window.innerWidth <= 1024;\n  @State() isChatOpen: boolean = false;\n  @State() isLoading: boolean = true;\n  @State() liveShopRegister: ILiveShop;\n  @State() liveShopItemsService: LiveShopHandler;\n  @State() liveShopItems: IHighlightCardItem[];\n  @State() liveSocket: WebSocketClient;\n\n  @Event({ bubbles: true, eventName: 'on-return-to-home' })\n  onReturnToHome: EventEmitter<void>;\n\n  @Event() componentRendered: EventEmitter<void>;\n\n  private handleResize = () => {\n    this.isSmallDevice = window.innerWidth <= 1024;\n  };\n\n  private isChatOpenHandler = () => {\n    this.isChatOpen = !this.isChatOpen;\n  };\n\n  private handleMessage = (event: MessageEvent<string>) => {\n    try {\n      if (!event.data) return;\n\n      const message: SocketMessage = JSON.parse(event.data);\n\n      const statusMap: Record<string, string> = {\n        liveOn: 'inLive',\n        liveOff: 'finished',\n      };\n\n      if (statusMap[message.type]) {\n        this.liveShopRegister = { ...this.liveShopRegister, status: statusMap[message.type] };\n        return;\n      }\n\n      this.liveShopItems = this.liveShopItemsService.updateItems(this.liveShopItems, message);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  disconnectedCallback() {\n    window.removeEventListener('resize', this.handleResize);\n    if (this.liveSocket) this.liveSocket.closeConnection();\n  }\n\n  async componentDidLoad() {\n    try {\n      if (!this.hashRoom) throw new Error('Hash Room is required');\n      this.isLoading = true;\n      window.addEventListener('resize', this.handleResize);\n      this.componentRendered.emit();\n      this.liveShopItemsService = new LiveShopHandler();\n      this.liveShopRegister = await this.liveShopItemsService.getLiveShop(this.hashRoom);\n      if (!this.liveShopRegister) throw new Error('live-shop_not_found');\n      this.liveShopItems = await this.liveShopItemsService.getItems();\n      if (this.liveShopRegister) {\n        this.videoId = extractYouTubeVideoId(this.liveShopRegister.urlLive);\n      }\n      const wsBaseUrl = Env.WEBSOCKET_URL || 'ws://localhost:3001';\n      this.liveSocket = new WebSocketClient(`${wsBaseUrl}?hashRoom=${this.hashRoom}`);\n      this.liveSocket.onMessage(this.handleMessage);\n    } catch (error) {\n      if (error?.message?.includes('live-shop_not_found')) {\n        this.liveShopNotFound = true;\n        console.error('Live Shop not found', { error });\n        return;\n      }\n      console.error(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private renderLoading() {\n    return (\n      <div class=\"loading-container\">\n        <span class=\"spinner\" />\n      </div>\n    );\n  }\n\n  private renderWarmup() {\n    return (\n      <div class=\"live-shop-warmup\">\n        <custom-card customClass=\"banner-custom-style\" cardTitle={this.liveShopRegister.title}>\n          {this.liveShopRegister.banner?.src ? (\n            <img src={this.liveShopRegister.banner.src} alt={this.liveShopRegister.banner.alt} />\n          ) : null}\n        </custom-card>\n      </div>\n    );\n  }\n\n  private renderInLive() {\n    return this.isSmallDevice ? (\n      <live-shop-mobile\n        videoId={this.videoId}\n        liveShopData={this.liveShopRegister}\n        items={this.liveShopItems}\n      ></live-shop-mobile>\n    ) : (\n      <live-shop-desktop\n        videoId={this.videoId}\n        liveShopData={this.liveShopRegister}\n        items={this.liveShopItems}\n        isChatOpen={this.isChatOpen}\n        toggleChat={() => this.isChatOpenHandler()}\n      />\n    );\n  }\n\n  private renderFinished() {\n    return (\n      <div class=\"live-shop-finished\">\n        <custom-card\n          customClass=\"button-custom-style\"\n          cardTitle=\"A live chegou ao fim!\"\n          cardDescription=\"Fique de olho em nossas próximas lives para mais novidades!\"\n        >\n          <button onClick={() => this.onReturnToHome.emit()}>Voltar para a página inicial</button>\n        </custom-card>\n      </div>\n    );\n  }\n\n  render() {\n    if (this.isLoading) {\n      return <Host>{this.renderLoading()}</Host>;\n    }\n\n    if (this.liveShopNotFound) {\n      return <live-shop-not-found onReturnToHome={() => this.onReturnToHome.emit()} />;\n    }\n\n    return (\n      <Host>\n        <div class=\"live-shop\">\n          {this.liveShopRegister?.status === 'warmup' && this.renderWarmup()}\n          {this.liveShopRegister?.status === 'inLive' && this.renderInLive()}\n          {this.liveShopRegister?.status === 'finished' && this.renderFinished()}\n        </div>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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"}