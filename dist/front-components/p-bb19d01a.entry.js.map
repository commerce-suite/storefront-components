{"version":3,"names":["LiveShopHandler","getProducts","productIds","this","liveShopData","products","map","product","productId","ProductService","getList","fields","filter","page","first","length","getLiveShop","hashRoom","LiveShopService","getByHash","productsToItemsAdapter","liveProducts","_a","edges","node","liveProduct","find","status","id","name","image","_c","_b","images","price","priceBase","priceCompare","title","content","type","slug","show","highlight","position","_d","showStartingFrom","hasPriceRange","messagesToItemsAdapter","messages","message","updateItems","items","maxPosition","Math","max","i","updatedItems","item","isHighlightOn","wasHighlightOn","isHidden","Object","assign","lastPosition","undefined","sort","a","b","getItems","productItems","messageItems","allItems","WebSocketClient","constructor","url","socket","reconnectAttempts","reconnectTimeout","messageCallback","onOpen","addEventListener","onClose","event","wasClean","handleReconnect","onError","connect","onclose","onerror","onmessage","WebSocket","onopen","MAX_RECONNECT_ATTEMPTS","delay","INITIAL_INCREMENT_DELAY","min","INITIAL_RECONNECT_DELAY","pow","MAX_RECONNECT_DELAY","window","setTimeout","closeConnection","readyState","OPEN","close","clearTimeout","onMessage","callback","liveShopCss","LiveShopStyle0","LiveShop","handleResize","isSmallDevice","innerWidth","isChatOpenHandler","isChatOpen","handleMessage","data","JSON","parse","statusMap","liveOn","liveOff","liveShopRegister","liveShopItems","liveShopItemsService","error","console","disconnectedCallback","removeEventListener","liveSocket","componentDidLoad","Error","isLoading","componentRendered","emit","videoId","extractYouTubeVideoId","urlLive","wsBaseUrl","includes","liveShopNotFound","renderLoading","h","class","renderWarmup","customClass","cardTitle","banner","src","alt","renderInLive","toggleChat","renderFinished","cardDescription","onClick","onReturnToHome","render","Host"],"sources":["src/components/live-shop/services/live-shop.service.ts","src/services/WebSocketClient.ts","src/components/live-shop/live-shop.scss?tag=live-shop","src/components/live-shop/live-shop.tsx"],"sourcesContent":["import { LiveShopService, ProductService } from '@uxshop/storefront-core';\nimport { LiveShop } from '@uxshop/storefront-core/dist/modules/live-shop/LiveShopTypes';\nimport { IHighlightCardItem } from '../../../components';\nimport { IImage } from '../../ui/product-card/product-card.type';\nimport { IMessageItem, IProductItem } from '../../ui/highlight-card/highlight-card.type';\nimport { SocketMessage } from '../live-shop.type';\n\nexport class LiveShopHandler {\n  private liveShopData: LiveShop;\n\n  private async getProducts() {\n    const productIds = this.liveShopData.products.map(product => product.productId);\n    return await ProductService.getList({\n      fields: [\n        'name',\n        'images { src }',\n        'price',\n        'priceCompare',\n        'productId',\n        'slug',\n        'hasPriceRange',\n      ],\n      filter: { productIds, page: 0, first: productIds.length },\n    });\n  }\n\n  async getLiveShop(hashRoom: string): Promise<LiveShop> {\n    this.liveShopData = await LiveShopService.getByHash(hashRoom);\n    return this.liveShopData;\n  }\n\n  async productsToItemsAdapter(): Promise<IProductItem[]> {\n    const products = await this.getProducts();\n    const liveProducts = this.liveShopData?.products;\n\n    return products.edges.map(({ node }) => {\n      const liveProduct = liveProducts.find(product => product.productId === node.productId);\n      const status = liveProduct?.status ?? null;\n      return {\n        id: +node.productId,\n        name: node.name,\n        image: (node?.images?.[0] as IImage) ?? null,\n        price: node.price,\n        priceBase: node.priceCompare,\n        title: '',\n        content: '',\n        type: 'product',\n        slug: node.slug,\n        show: status && status !== 'hidden',\n        highlight: status === 'highlighting',\n        position: liveProduct?.position ?? 0,\n        showStartingFrom: node.hasPriceRange,\n      };\n    });\n  }\n\n  messagesToItemsAdapter(): IMessageItem[] {\n    return this.liveShopData.messages.map(message => ({\n      id: message.id ?? null,\n      title: message.title,\n      content: message.content,\n      type: 'message',\n      show: message.status && message.status !== 'hidden',\n      highlight: message.status === 'highlighting',\n      position: message.position ?? 0,\n    }));\n  }\n\n  updateItems(items: IHighlightCardItem[], message: SocketMessage): IHighlightCardItem[] {\n    const maxPosition = Math.max(...items.map(i => i.position ?? 0));\n\n    const updatedItems = items.map(item => {\n      if (item.id !== message.id || item.type !== message.type) return item;\n\n      const isHighlightOn = message.status === 'highlighting';\n      const wasHighlightOn = !!item.highlight;\n      const isHidden = message.status === 'hidden';\n\n      if (isHighlightOn && !wasHighlightOn) {\n        return {\n          ...item,\n          show: !isHidden,\n          highlight: true,\n          lastPosition: item.lastPosition ?? item.position,\n          position: maxPosition + 1,\n        };\n      }\n\n      if (!isHighlightOn && wasHighlightOn) {\n        return {\n          ...item,\n          show: !isHidden,\n          highlight: false,\n          position: item.lastPosition ?? item.position,\n          lastPosition: undefined,\n        };\n      }\n\n      return {\n        ...item,\n        show: !isHidden,\n        highlight: isHighlightOn,\n        position: maxPosition + 1,\n      };\n    });\n\n    updatedItems.sort((a, b) => (b.position ?? 0) - (a.position ?? 0));\n    return updatedItems;\n  }\n\n  async getItems(): Promise<IHighlightCardItem[]> {\n    const productItems = await this.productsToItemsAdapter();\n    const messageItems = this.messagesToItemsAdapter();\n\n    const allItems = [...productItems, ...messageItems];\n\n    allItems.sort((a, b) => b.position - a.position);\n\n    return allItems;\n  }\n}\n","export class WebSocketClient {\n  private static readonly MAX_RECONNECT_ATTEMPTS = 5;\n  private static readonly INITIAL_RECONNECT_DELAY = 5000;\n  private static readonly MAX_RECONNECT_DELAY = 30000;\n  private static readonly INITIAL_INCREMENT_DELAY = 1000;\n\n  private socket: WebSocket | null = null;\n  private reconnectAttempts = 0;\n  private reconnectTimeout: number | null = null;\n  private url: string;\n  private messageCallback: ((event: MessageEvent) => void) | null = null;\n\n  constructor(url: string) {\n    this.url = url;\n    this.connect();\n  }\n\n  private connect() {\n    if (this.socket) {\n      this.socket.onclose = null;\n      this.socket.onerror = null;\n      this.socket.onmessage = null;\n    }\n\n    this.socket = new WebSocket(this.url);\n\n    this.socket.onopen = this.onOpen;\n    this.socket.onclose = this.onClose;\n    this.socket.onerror = this.onError;\n  }\n\n  private onOpen = () => {\n    this.reconnectAttempts = 0;\n\n    if (this.messageCallback && this.socket) {\n      this.socket.addEventListener('message', this.messageCallback);\n    }\n  };\n\n  public onClose = (event: CloseEvent) => {\n    if (!event.wasClean) this.handleReconnect();\n  };\n\n  private onError = () => {\n    this.handleReconnect();\n  };\n\n  private handleReconnect() {\n    if (this.reconnectTimeout !== null) return;\n\n    if (this.reconnectAttempts >= WebSocketClient.MAX_RECONNECT_ATTEMPTS) return;\n\n    const delay =\n      this.reconnectAttempts === 0\n        ? WebSocketClient.INITIAL_INCREMENT_DELAY\n        : Math.min(\n            WebSocketClient.INITIAL_RECONNECT_DELAY * Math.pow(2, this.reconnectAttempts - 1),\n            WebSocketClient.MAX_RECONNECT_DELAY,\n          );\n\n    this.reconnectTimeout = window.setTimeout(() => {\n      this.reconnectAttempts++;\n      this.reconnectTimeout = null;\n      this.connect();\n    }, delay);\n  }\n\n  public closeConnection() {\n    if (this.socket?.readyState === WebSocket.OPEN) {\n      this.socket.close();\n    }\n    if (this.reconnectTimeout !== null) {\n      clearTimeout(this.reconnectTimeout);\n      this.reconnectTimeout = null;\n    }\n  }\n\n  public onMessage(callback: (event: MessageEvent) => void) {\n    this.messageCallback = callback;\n    if (this.socket) {\n      this.socket.addEventListener('message', callback);\n    }\n  }\n}\n","@import '../../style/mixins/button.scss';\n@import '../../style/mixins/spinner-loading.scss';\n\n:host {\n  display: block;\n  width: 100%;\n}\n\n.loading-container {\n  display: flex;\n  width: 100%;\n  justify-content: center;\n  align-items: center;\n  min-height: 350px;\n\n  .spinner {\n    @include lds-dual-ring;\n  }\n}\n\n.live-shop {\n  &-warmup {\n    .banner-custom-style {\n      padding: 40px;\n\n      > .custom-card-content {\n        width: 100%;\n        max-width: 720px;\n        height: auto;\n        aspect-ratio: 16 / 9;\n\n        & img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        }\n\n        .live-shop-banner {\n          background-color: #d9d9d9;\n          height: 100%;\n          width: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n      }\n    }\n  }\n\n  &-finished {\n    .button-custom-style {\n      padding: 40px;\n      max-width: 410px;\n      margin: 0 auto;\n      text-align: center;\n\n      & button {\n        @include front-button;\n        font-weight: 500;\n        font-size: 14px;\n      }\n    }\n  }\n}\n","import { Component, Event, Host, EventEmitter, h, State, Prop, Env } from '@stencil/core';\nimport { ILiveShop, SocketMessage } from './live-shop.type';\nimport { IHighlightCardItem } from '../../components';\nimport { LiveShopHandler } from './services/live-shop.service';\nimport { WebSocketClient } from '../../services/WebSocketClient';\nimport { extractYouTubeVideoId } from '../../utils/utils';\n\n@Component({\n  tag: 'live-shop',\n  styleUrl: 'live-shop.scss',\n  shadow: false,\n})\nexport class LiveShop {\n  @Prop() hashRoom: string;\n  @State() liveShopNotFound: boolean = false;\n  @State() videoId: string;\n  @State() isSmallDevice: boolean = window.innerWidth <= 1024;\n  @State() isChatOpen: boolean = false;\n  @State() isLoading: boolean = true;\n  @State() liveShopRegister: ILiveShop;\n  @State() liveShopItemsService: LiveShopHandler;\n  @State() liveShopItems: IHighlightCardItem[];\n  @State() liveSocket: WebSocketClient;\n\n  @Event({ bubbles: true, eventName: 'on-return-to-home' })\n  onReturnToHome: EventEmitter<void>;\n\n  @Event() componentRendered: EventEmitter<void>;\n\n  private handleResize = () => {\n    this.isSmallDevice = window.innerWidth <= 1024;\n  };\n\n  private isChatOpenHandler = () => {\n    this.isChatOpen = !this.isChatOpen;\n  };\n\n  private handleMessage = (event: MessageEvent<string>) => {\n    try {\n      if (!event.data) return;\n\n      const message: SocketMessage = JSON.parse(event.data);\n\n      const statusMap: Record<string, string> = {\n        liveOn: 'inLive',\n        liveOff: 'finished',\n      };\n\n      if (statusMap[message.type]) {\n        this.liveShopRegister = { ...this.liveShopRegister, status: statusMap[message.type] };\n        return;\n      }\n\n      this.liveShopItems = this.liveShopItemsService.updateItems(this.liveShopItems, message);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  disconnectedCallback() {\n    window.removeEventListener('resize', this.handleResize);\n    if (this.liveSocket) this.liveSocket.closeConnection();\n  }\n\n  async componentDidLoad() {\n    try {\n      if (!this.hashRoom) throw new Error('Hash Room is required');\n      this.isLoading = true;\n      window.addEventListener('resize', this.handleResize);\n      this.componentRendered.emit();\n      this.liveShopItemsService = new LiveShopHandler();\n      this.liveShopRegister = await this.liveShopItemsService.getLiveShop(this.hashRoom);\n      if (!this.liveShopRegister) throw new Error('live-shop_not_found');\n      this.liveShopItems = await this.liveShopItemsService.getItems();\n      if (this.liveShopRegister) {\n        this.videoId = extractYouTubeVideoId(this.liveShopRegister.urlLive);\n      }\n      const wsBaseUrl = Env.WEBSOCKET_URL || 'ws://localhost:3001';\n      this.liveSocket = new WebSocketClient(`${wsBaseUrl}?hashRoom=${this.hashRoom}`);\n      this.liveSocket.onMessage(this.handleMessage);\n    } catch (error) {\n      if (error?.message?.includes('live-shop_not_found')) {\n        this.liveShopNotFound = true;\n        console.error('Live Shop not found', { error });\n        return;\n      }\n      console.error(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private renderLoading() {\n    return (\n      <div class=\"loading-container\">\n        <span class=\"spinner\" />\n      </div>\n    );\n  }\n\n  private renderWarmup() {\n    return (\n      <div class=\"live-shop-warmup\">\n        <custom-card customClass=\"banner-custom-style\" cardTitle={this.liveShopRegister.title}>\n          {this.liveShopRegister.banner?.src ? (\n            <img src={this.liveShopRegister.banner.src} alt={this.liveShopRegister.banner.alt} />\n          ) : null}\n        </custom-card>\n      </div>\n    );\n  }\n\n  private renderInLive() {\n    return this.isSmallDevice ? (\n      <live-shop-mobile\n        videoId={this.videoId}\n        liveShopData={this.liveShopRegister}\n        items={this.liveShopItems}\n      ></live-shop-mobile>\n    ) : (\n      <live-shop-desktop\n        videoId={this.videoId}\n        liveShopData={this.liveShopRegister}\n        items={this.liveShopItems}\n        isChatOpen={this.isChatOpen}\n        toggleChat={() => this.isChatOpenHandler()}\n      />\n    );\n  }\n\n  private renderFinished() {\n    return (\n      <div class=\"live-shop-finished\">\n        <custom-card\n          customClass=\"button-custom-style\"\n          cardTitle=\"A live chegou ao fim!\"\n          cardDescription=\"Fique de olho em nossas próximas lives para mais novidades!\"\n        >\n          <button onClick={() => this.onReturnToHome.emit()}>Voltar para a página inicial</button>\n        </custom-card>\n      </div>\n    );\n  }\n\n  render() {\n    if (this.isLoading) {\n      return <Host>{this.renderLoading()}</Host>;\n    }\n\n    if (this.liveShopNotFound) {\n      return <live-shop-not-found onReturnToHome={() => this.onReturnToHome.emit()} />;\n    }\n\n    return (\n      <Host>\n        <div class=\"live-shop\">\n          {this.liveShopRegister?.status === 'warmup' && this.renderWarmup()}\n          {this.liveShopRegister?.status === 'inLive' && this.renderInLive()}\n          {this.liveShopRegister?.status === 'finished' && this.renderFinished()}\n        </div>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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"}