{"file":"cashback-credit.entry.esm.js","mappings":"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","names":[],"sources":["src/components/cashback/cashback.service.ts","src/components/cashback/cashback.type.ts","src/components/cashback/cashback.scss?tag=cashback-credit&encapsulation=scoped","src/components/cashback/cashback.tsx"],"sourcesContent":["import { Calculation, CalculationPayload } from './cashback.type';\n\nexport interface CashbackService {\n  calculate(data: CalculationPayload): Promise<Calculation>;\n}\n\nconst exec = (method: string, url: string, data?: Record<string, any>): Promise<any> => {\n  return new Promise((resolve, reject) => {\n    const req = new XMLHttpRequest();\n    req.open(method, url, true);\n    req.setRequestHeader('X-Ajax', 'true');\n    req.setRequestHeader('Content-Type', 'application/json');\n\n    req.onload = function () {\n      if (req.status >= 200 && req.status < 300) {\n        resolve(JSON.parse(req.responseText));\n      } else {\n        reject(req.status);\n      }\n    };\n\n    req.send(data ? JSON.stringify(data) : null);\n  });\n};\n\nexport const cashbackService: CashbackService = {\n  async calculate(data: CalculationPayload): Promise<Calculation> {\n    return await exec('POST', `${window.dooca.base_url}/action/promotions/calculate`, data);\n  },\n};\n","import { UUID } from 'crypto';\n\nexport interface ICashbackSettingRange {\n  min: number;\n  max: number;\n  markup: number;\n}\n\nexport interface ICashback {\n  id: UUID;\n  organization_id: number;\n  markup: number | string;\n  type: string;\n  release_days: number;\n  expiration_days: number;\n  exclude_categories?: number[] | null;\n  allowed_categories?: number[] | null;\n  allow_extra_discounts: boolean;\n  active: boolean;\n  active_to_use: boolean;\n  show_extract: boolean;\n  show_credit_preview: boolean;\n  max_representativeness?: number;\n  representativeness_type: string;\n  ranges?: ICashbackSettingRange[] | null;\n  created_at: string;\n  updated_at: string;\n}\n\nexport enum CalculationItemPromotion {\n  CASHBACK_CREDIT = 'cashback_credit',\n  CASHBACK_DEBIT = 'cashback_debit',\n}\n\nexport interface CalculationItem {\n  id: UUID;\n  promotion: CalculationItemPromotion;\n  value: number;\n  remaining_to_apply: number;\n  not_applicable_reasons: string[];\n}\n\nexport interface Calculation {\n  id: UUID;\n  customer_id?: number;\n  source: string;\n  source_id?: number;\n  check_sum: string;\n  items: CalculationItem[];\n}\n\nexport interface CalculationItemPayload {\n  id: number;\n  quantity: number;\n  price: number;\n  discount: number;\n}\n\nexport interface CalculationPayload {\n  customer_id: number | null;\n  exclude_promotions: CalculationItemPromotion[];\n  items: CalculationItemPayload[];\n}\n",".cashback {\n    display: inline-flex;\n\n    img {\n        margin-right: .5rem;\n    }\n\n    span {\n        color: var(--success);\n    }\n}","import {\n  Component,\n  ComponentWillLoad,\n  getAssetPath,\n  Host,\n  h,\n  Prop,\n  State,\n  Watch,\n} from '@stencil/core';\nimport { cashbackService } from './cashback.service';\nimport {\n  CalculationItem,\n  CalculationItemPromotion,\n  CalculationPayload,\n  ICashback,\n} from './cashback.type';\nimport { currencyFormat } from '../../utils/utils';\n\n@Component({\n  tag: 'cashback-credit',\n  styleUrl: 'cashback.scss',\n  scoped: true,\n})\nexport class Cashback implements ComponentWillLoad {\n  @Prop() customer_id: number | null;\n  @Prop() cashback: ICashback | null;\n  @Prop({ mutable: true }) product: { id: number; price: number };\n\n  @State() credit: CalculationItem;\n\n  async componentWillLoad(): Promise<void> {\n    await this.getCalculation();\n  }\n\n  @Watch('customer_id')\n  async onCustomerIdChange(): Promise<void> {\n    await this.getCalculation();\n  }\n\n  @Watch('product')\n  async onProductChange(): Promise<void> {\n    await this.getCalculation();\n  }\n\n  async getCalculation(): Promise<void> {\n    const valid = this.cashback && this.cashback.active && this.cashback.show_credit_preview;\n\n    if (!this.product || !valid) return;\n\n    const { id, price } = this.product;\n\n    const data: CalculationPayload = {\n      customer_id: this.customer_id,\n      exclude_promotions: [CalculationItemPromotion.CASHBACK_DEBIT],\n      items: [\n        {\n          id,\n          quantity: 1,\n          price,\n          discount: 0,\n        },\n      ],\n    };\n\n    const res = await cashbackService.calculate(data);\n\n    const byCredit = (item: CalculationItem) =>\n      CalculationItemPromotion.CASHBACK_CREDIT === item.promotion;\n    this.credit = res.items?.find(byCredit);\n  }\n\n  render() {\n    return (\n      <Host>\n        {this.credit && this.credit.value > 0 ? (\n          <div class=\"cashback\">\n            <img src={getAssetPath('./assets/icons/cashback.svg')} />\n            <span>\n              Na compra deste produto, você receberá até{' '}\n              <strong>{currencyFormat(this.credit.value)}</strong> em Cashback!\n            </span>\n          </div>\n        ) : null}\n      </Host>\n    );\n  }\n}\n"],"version":3}