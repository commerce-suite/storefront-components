import{r as t,c as i,h as s,H as e}from"./p-040ae869.js";import{P as n,L as o}from"./p-38c1f26e.js";import{e as r}from"./p-80ff7aad.js";class a{async getProducts(){const t=this.liveShopData.products.map((t=>t.productId));return await n.getList({fields:["name","images { src }","price","priceCompare","productId","slug","hasPriceRange"],filter:{productIds:t,page:0,first:t.length}})}async getLiveShop(t){this.liveShopData=await o.getByHash(t);return this.liveShopData}async productsToItemsAdapter(){var t;const i=await this.getProducts();const s=(t=this.liveShopData)===null||t===void 0?void 0:t.products;return i.edges.map((({node:t})=>{var i,e,n;const o=s.find((i=>i.productId===t.productId));const r=(i=o===null||o===void 0?void 0:o.status)!==null&&i!==void 0?i:null;return{id:+t.productId,name:t.name,image:(n=(e=t===null||t===void 0?void 0:t.images)===null||e===void 0?void 0:e[0])!==null&&n!==void 0?n:null,price:t.price,priceBase:t.priceCompare,title:"",content:"",type:"product",slug:t.slug,show:r&&r!=="hidden",highlight:r==="highlighting",showStartingFrom:t.hasPriceRange}}))}messagesToItemsAdapter(){return this.liveShopData.messages.map((t=>{var i;return{id:(i=t.id)!==null&&i!==void 0?i:null,title:t.title,content:t.content,type:"message",show:t.status&&t.status!=="hidden",highlight:t.status==="highlighting"}}))}updateItems(t,i){const s=t.map((t=>{if(t.id===i.id&&t.type===i.type){return Object.assign(Object.assign({},t),{show:i.status!=="hidden",highlight:i.status==="highlighting"})}return t}));return s}async getItems(){const t=await this.productsToItemsAdapter();const i=this.messagesToItemsAdapter();return[...t,...i]}}class h{constructor(t){this.socket=null;this.reconnectAttempts=0;this.reconnectTimeout=null;this.messageCallback=null;this.onOpen=()=>{this.reconnectAttempts=0;if(this.messageCallback&&this.socket){this.socket.addEventListener("message",this.messageCallback)}};this.onClose=t=>{if(!t.wasClean)this.handleReconnect()};this.onError=()=>{this.handleReconnect()};this.url=t;this.connect()}connect(){if(this.socket){this.socket.onclose=null;this.socket.onerror=null;this.socket.onmessage=null}this.socket=new WebSocket(this.url);this.socket.onopen=this.onOpen;this.socket.onclose=this.onClose;this.socket.onerror=this.onError}handleReconnect(){if(this.reconnectTimeout!==null)return;if(this.reconnectAttempts>=h.MAX_RECONNECT_ATTEMPTS)return;const t=this.reconnectAttempts===0?h.INITIAL_INCREMENT_DELAY:Math.min(h.INITIAL_RECONNECT_DELAY*Math.pow(2,this.reconnectAttempts-1),h.MAX_RECONNECT_DELAY);this.reconnectTimeout=window.setTimeout((()=>{this.reconnectAttempts++;this.reconnectTimeout=null;this.connect()}),t)}closeConnection(){var t;if(((t=this.socket)===null||t===void 0?void 0:t.readyState)===WebSocket.OPEN){this.socket.close()}if(this.reconnectTimeout!==null){clearTimeout(this.reconnectTimeout);this.reconnectTimeout=null}}onMessage(t){this.messageCallback=t;if(this.socket){this.socket.addEventListener("message",t)}}}h.MAX_RECONNECT_ATTEMPTS=5;h.INITIAL_RECONNECT_DELAY=5e3;h.MAX_RECONNECT_DELAY=3e4;h.INITIAL_INCREMENT_DELAY=1e3;const l='*{--fc-font-family:var(--m-ff);--fc-border-radius:4px;--fc-color-primary:var(--color-primary, #ff4295);--fc-color-secondary:var(--color-secondary, #000);--fc-color-white:var(--white, #fff);--fc-m-tt:var(--m-tt, "uppercase");--fc-m-fs:var(--m-fs, 14px);--fc-m-fw:var(--m-fw, 600);--fc-m-ls:var(--m-ls, 1px);--fc-h2-fs:var(--h2-fs, 18px);--fc-h2-fw:var(--h2-fw, 600);--fc-h2-ls:var(--h2-ls, 0px);--fc-color-light-text-default:#343a40;--fc-color-light-text-secondary:#6d747a;--fc-color-light-border-default:#dee2e6;--fc-gap-grid:24px;--fc-margin-width:8px}@keyframes lds-dual-ring-animation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes simple-spinner-animation{0%{transform:translate(-50%, -50%) rotate(0deg)}100%{transform:translate(-50%, -50%) rotate(360deg)}}:host{display:block;width:100%}.loading-container{display:flex;width:100%;justify-content:center;align-items:center;min-height:350px}.loading-container .spinner{--spinner-color:var(--fc-color-secondary, #000);display:inline-block;width:80px;height:80px}.loading-container .spinner:after{content:" ";display:block;width:64px;height:64px;margin:8px;border-radius:50%;border:6px solid var(--spinner-color);border-color:var(--spinner-color) transparent var(--spinner-color) transparent;animation:lds-dual-ring-animation 1.2s linear infinite}.live-shop-warmup .banner-custom-style{padding:40px}.live-shop-warmup .banner-custom-style>.custom-card-content{width:100%;max-width:720px;height:auto;aspect-ratio:16/9}.live-shop-warmup .banner-custom-style>.custom-card-content img{width:100%;height:100%;object-fit:cover}.live-shop-warmup .banner-custom-style>.custom-card-content .live-shop-banner{background-color:#d9d9d9;height:100%;width:100%;display:flex;align-items:center;justify-content:center}.live-shop-finished .button-custom-style{padding:40px;max-width:410px;margin:0 auto;text-align:center}.live-shop-finished .button-custom-style button{--btn-bg-color:var(--fc-color-primary);--btn-text-color:var(--fc-color-white);--btn-text-weight:var(--fc-m-fw, 600);--btn-text-size:var(--fc-m-fs);--btn-text-transform:var(--fc-m-tt, "uppercase");--btn-text-letter-spacing:var(--fc-m-ls, 1px);all:unset;box-sizing:border-box;width:100%;background-color:var(--btn-bg-color);color:var(--btn-text-color);font-weight:var(--btn-text-weight);font-size:var(--btn-text-size);padding:12px 24px;cursor:pointer;border-radius:var(--fc-border-radius);text-align:center;text-transform:var(--btn-text-transform);letter-spacing:var(--btn-text-letter-spacing);font-weight:500;font-size:14px}.live-shop-finished .button-custom-style button:hover{opacity:0.75}.live-shop-finished .button-custom-style button:disabled{opacity:0.6;cursor:not-allowed}';const c=l;const d=class{constructor(s){t(this,s);this.onReturnToHome=i(this,"on-return-to-home",7);this.componentRendered=i(this,"componentRendered",7);this.handleResize=()=>{this.isSmallDevice=window.innerWidth<=1024};this.isChatOpenHandler=()=>{this.isChatOpen=!this.isChatOpen};this.handleMessage=t=>{try{if(!t.data)return;const i=JSON.parse(t.data);const s={liveOn:"inLive",liveOff:"finished"};if(s[i.type]){this.liveShopRegister=Object.assign(Object.assign({},this.liveShopRegister),{status:s[i.type]});return}this.liveShopItems=this.liveShopItemsService.updateItems(this.liveShopItems,i)}catch(t){console.error(t)}};this.hashRoom=undefined;this.liveShopNotFound=false;this.videoId=undefined;this.isSmallDevice=window.innerWidth<=1024;this.isChatOpen=false;this.isLoading=true;this.liveShopRegister=undefined;this.liveShopItemsService=undefined;this.liveShopItems=undefined;this.liveSocket=undefined}disconnectedCallback(){window.removeEventListener("resize",this.handleResize);if(this.liveSocket)this.liveSocket.closeConnection()}async componentDidLoad(){var t;try{if(!this.hashRoom)throw new Error("Hash Room is required");this.isLoading=true;window.addEventListener("resize",this.handleResize);this.componentRendered.emit();this.liveShopItemsService=new a;this.liveShopRegister=await this.liveShopItemsService.getLiveShop(this.hashRoom);if(!this.liveShopRegister)throw new Error("live-shop_not_found");this.liveShopItems=await this.liveShopItemsService.getItems();if(this.liveShopRegister){this.videoId=r(this.liveShopRegister.urlLive)}const t="ws://localhost:3001";this.liveSocket=new h(`${t}?hashRoom=${this.hashRoom}`);this.liveSocket.onMessage(this.handleMessage)}catch(i){if((t=i===null||i===void 0?void 0:i.message)===null||t===void 0?void 0:t.includes("live-shop_not_found")){this.liveShopNotFound=true;console.error("Live Shop not found",{error:i});return}console.error(i)}finally{this.isLoading=false}}renderLoading(){return s("div",{class:"loading-container"},s("span",{class:"spinner"}))}renderWarmup(){var t;return s("div",{class:"live-shop-warmup"},s("custom-card",{customClass:"banner-custom-style",cardTitle:this.liveShopRegister.title},((t=this.liveShopRegister.banner)===null||t===void 0?void 0:t.src)?s("img",{src:this.liveShopRegister.banner.src,alt:this.liveShopRegister.banner.alt}):null))}renderInLive(){return this.isSmallDevice?s("live-shop-mobile",{videoId:this.videoId,liveShopData:this.liveShopRegister,items:this.liveShopItems}):s("live-shop-desktop",{videoId:this.videoId,liveShopData:this.liveShopRegister,items:this.liveShopItems,isChatOpen:this.isChatOpen,toggleChat:()=>this.isChatOpenHandler()})}renderFinished(){return s("div",{class:"live-shop-finished"},s("custom-card",{customClass:"button-custom-style",cardTitle:"A live chegou ao fim!",cardDescription:"Fique de olho em nossas próximas lives para mais novidades!"},s("button",{onClick:()=>this.onReturnToHome.emit()},"Voltar para a página inicial")))}render(){var t,i,n;if(this.isLoading){return s(e,null,this.renderLoading())}if(this.liveShopNotFound){return s("live-shop-not-found",{onReturnToHome:()=>this.onReturnToHome.emit()})}return s(e,null,s("div",{class:"live-shop"},((t=this.liveShopRegister)===null||t===void 0?void 0:t.status)==="warmup"&&this.renderWarmup(),((i=this.liveShopRegister)===null||i===void 0?void 0:i.status)==="inLive"&&this.renderInLive(),((n=this.liveShopRegister)===null||n===void 0?void 0:n.status)==="finished"&&this.renderFinished()))}};d.style=c;export{d as live_shop};
//# sourceMappingURL=p-552bb842.entry.js.map