{"version":3,"file":"live-shop.js","sourceRoot":"","sources":["../../../src/components/live-shop/live-shop.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, Host, EventEmitter, h, State, Prop } from '@stencil/core';\nimport { ILiveShop, SocketMessage } from './live-shop.type';\nimport { IHighlightCardItem } from '../../components';\nimport { LiveShopHandler } from './services/live-shop.service';\nimport { WebSocketClient } from '../../services/WebSocketClient';\n\n@Component({\n  tag: 'live-shop',\n  styleUrl: 'live-shop.scss',\n  shadow: false,\n})\nexport class LiveShop {\n  @Prop() hashRoom: string;\n  @State() liveShopNotFound: boolean = false;\n  @State() videoId: string;\n  @State() isSmallDevice: boolean = window.innerWidth <= 1024;\n  @State() isChatOpen: boolean = false;\n  @State() isLoading: boolean = true;\n  @State() liveShopRegister: ILiveShop;\n  @State() liveShopItemsService: LiveShopHandler;\n  @State() liveShopItems: IHighlightCardItem[];\n  @State() liveSocket: WebSocketClient;\n\n  @Event({ bubbles: true, eventName: 'on-return-to-home' })\n  onReturnToHome: EventEmitter<void>;\n\n  @Event() componentRendered: EventEmitter<void>;\n\n  private handleResize = () => {\n    this.isSmallDevice = window.innerWidth <= 1024;\n  };\n\n  private isChatOpenHandler = () => {\n    this.isChatOpen = !this.isChatOpen;\n  };\n\n  private handleMessage = (event: MessageEvent<string>) => {\n    try {\n      if (event.data) {\n        const message: SocketMessage = JSON.parse(event.data);\n        this.liveShopItems = this.liveShopItemsService.updateItems(this.liveShopItems, message);\n      }\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  disconnectedCallback() {\n    window.removeEventListener('resize', this.handleResize);\n  }\n\n  async componentWillLoad() {\n    try {\n      if (!this.hashRoom) throw new Error('Hash Room is required');\n      this.isLoading = true;\n      window.addEventListener('resize', this.handleResize);\n      this.componentRendered.emit();\n      this.liveShopItemsService = new LiveShopHandler();\n      this.liveShopRegister = await this.liveShopItemsService.getLiveShop(this.hashRoom);\n      this.liveShopItems = await this.liveShopItemsService.getItems();\n      if (this.liveShopRegister) this.videoId = this.liveShopRegister.urlLive.split('v=')[1];\n      this.liveSocket = new WebSocketClient(`ws://localhost:3001?hashRoom=${this.hashRoom}`);\n      this.liveSocket.onMessage(this.handleMessage);\n    } catch (error) {\n      if (error?.message?.includes('live-shop_not_found')) {\n        this.liveShopNotFound = true;\n        console.error('Live Shop not found', { error });\n      }\n      console.error(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private renderLoading() {\n    return (\n      <div class=\"loading-container\">\n        <span class=\"spinner\" />\n      </div>\n    );\n  }\n\n  private renderWarmup() {\n    return (\n      <div class=\"live-shop-warmup\">\n        <custom-card customClass=\"banner-custom-style\" cardTitle={this.liveShopRegister.title}>\n          {this.liveShopRegister.banner ? (\n            <img src={this.liveShopRegister.banner.src} alt={this.liveShopRegister.banner.alt} />\n          ) : (\n            <div class=\"live-shop-banner\" />\n          )}\n        </custom-card>\n      </div>\n    );\n  }\n\n  private renderInLive() {\n    return this.isSmallDevice ? (\n      <live-shop-mobile\n        videoId={this.videoId}\n        liveShopData={this.liveShopRegister}\n        items={this.liveShopItems}\n      ></live-shop-mobile>\n    ) : (\n      <live-shop-desktop\n        videoId={this.videoId}\n        liveShopData={this.liveShopRegister}\n        items={this.liveShopItems}\n        isChatOpen={this.isChatOpen}\n        toggleChat={() => this.isChatOpenHandler()}\n      />\n    );\n  }\n\n  private renderFinished() {\n    return (\n      <div class=\"live-shop-finished\">\n        <custom-card\n          customClass=\"button-custom-style\"\n          cardTitle=\"A live chegou ao fim!\"\n          cardDescription=\"Fique de olho em nossas próximas lives para mais novidades e promoções imperdíveis!\"\n        >\n          <button onClick={() => this.onReturnToHome.emit()}>Voltar para a página inicial</button>\n        </custom-card>\n      </div>\n    );\n  }\n\n  render() {\n    if (this.isLoading) {\n      return <Host>{this.renderLoading()}</Host>;\n    }\n\n    if (this.liveShopNotFound) {\n      return <live-shop-not-found onReturnToHome={() => this.onReturnToHome.emit()} />;\n    }\n\n    return (\n      <Host>\n        <div class=\"live-shop\">\n          {this.liveShopRegister?.status === 'warmup' && this.renderWarmup()}\n          {this.liveShopRegister?.status === 'inLive' && this.renderInLive()}\n          {this.liveShopRegister?.status === 'finished' && this.renderFinished()}\n        </div>\n      </Host>\n    );\n  }\n}\n"]}