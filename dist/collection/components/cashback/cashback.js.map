{"version":3,"file":"cashback.js","sourceRoot":"","sources":["../../../src/components/cashback/cashback.tsx"],"names":[],"mappings":"AAAA,OAAO,EACL,SAAS,EAET,YAAY,EACZ,IAAI,EACJ,CAAC,EACD,IAAI,EACJ,KAAK,EACL,KAAK,GACN,MAAM,eAAe,CAAC;AACvB,OAAO,EAAE,eAAe,EAAE,MAAM,oBAAoB,CAAC;AACrD,OAAO,EAEL,wBAAwB,GAGzB,MAAM,iBAAiB,CAAC;AACzB,OAAO,EAAE,cAAc,EAAE,MAAM,mBAAmB,CAAC;AAOnD,MAAM,OAAO,QAAQ;;;;;;;IAOnB,KAAK,CAAC,iBAAiB;QACrB,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;IAC9B,CAAC;IAGD,KAAK,CAAC,kBAAkB;QACtB,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;IAC9B,CAAC;IAGD,KAAK,CAAC,eAAe;QACnB,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;IAC9B,CAAC;IAED,KAAK,CAAC,cAAc;;QAClB,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC;QAEzF,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,KAAK;YAAE,OAAO;QAEpC,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC;QAEnC,MAAM,IAAI,GAAuB;YAC/B,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,kBAAkB,EAAE,CAAC,wBAAwB,CAAC,cAAc,CAAC;YAC7D,KAAK,EAAE;gBACL;oBACE,EAAE;oBACF,QAAQ,EAAE,CAAC;oBACX,KAAK;oBACL,QAAQ,EAAE,CAAC;iBACZ;aACF;SACF,CAAC;QAEF,MAAM,GAAG,GAAG,MAAM,eAAe,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QAElD,MAAM,QAAQ,GAAG,CAAC,IAAqB,EAAE,EAAE,CACzC,wBAAwB,CAAC,eAAe,KAAK,IAAI,CAAC,SAAS,CAAC;QAC9D,IAAI,CAAC,MAAM,GAAG,MAAA,GAAG,CAAC,KAAK,0CAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC1C,CAAC;IAED,MAAM;QACJ,OAAO,CACL,EAAC,IAAI,uDACF,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,CACtC,WAAK,KAAK,EAAC,UAAU;YACnB,WAAK,GAAG,EAAE,YAAY,CAAC,6BAA6B,CAAC,GAAI;YACzD;;gBAC6C,GAAG;gBAC9C,kBAAS,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAU;gCAC/C,CACH,CACP,CAAC,CAAC,CAAC,IAAI,CACH,CACR,CAAC;IACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import {\n  Component,\n  ComponentWillLoad,\n  getAssetPath,\n  Host,\n  h,\n  Prop,\n  State,\n  Watch,\n} from '@stencil/core';\nimport { cashbackService } from './cashback.service';\nimport {\n  CalculationItem,\n  CalculationItemPromotion,\n  CalculationPayload,\n  ICashback,\n} from './cashback.type';\nimport { currencyFormat } from '../../utils/utils';\n\n@Component({\n  tag: 'cashback-credit',\n  styleUrl: 'cashback.scss',\n  scoped: true,\n})\nexport class Cashback implements ComponentWillLoad {\n  @Prop() customer_id: number | null;\n  @Prop() cashback: ICashback | null;\n  @Prop({ mutable: true }) product: { id: number; price: number };\n\n  @State() credit: CalculationItem;\n\n  async componentWillLoad(): Promise<void> {\n    await this.getCalculation();\n  }\n\n  @Watch('customer_id')\n  async onCustomerIdChange(): Promise<void> {\n    await this.getCalculation();\n  }\n\n  @Watch('product')\n  async onProductChange(): Promise<void> {\n    await this.getCalculation();\n  }\n\n  async getCalculation(): Promise<void> {\n    const valid = this.cashback && this.cashback.active && this.cashback.show_credit_preview;\n\n    if (!this.product || !valid) return;\n\n    const { id, price } = this.product;\n\n    const data: CalculationPayload = {\n      customer_id: this.customer_id,\n      exclude_promotions: [CalculationItemPromotion.CASHBACK_DEBIT],\n      items: [\n        {\n          id,\n          quantity: 1,\n          price,\n          discount: 0,\n        },\n      ],\n    };\n\n    const res = await cashbackService.calculate(data);\n\n    const byCredit = (item: CalculationItem) =>\n      CalculationItemPromotion.CASHBACK_CREDIT === item.promotion;\n    this.credit = res.items?.find(byCredit);\n  }\n\n  render() {\n    return (\n      <Host>\n        {this.credit && this.credit.value > 0 ? (\n          <div class=\"cashback\">\n            <img src={getAssetPath('./assets/icons/cashback.svg')} />\n            <span>\n              Na compra deste produto, você receberá até{' '}\n              <strong>{currencyFormat(this.credit.value)}</strong> em Cashback!\n            </span>\n          </div>\n        ) : null}\n      </Host>\n    );\n  }\n}\n"]}