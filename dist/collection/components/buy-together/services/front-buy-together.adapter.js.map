{"version":3,"file":"front-buy-together.adapter.js","sourceRoot":"","sources":["../../../../src/components/buy-together/services/front-buy-together.adapter.ts"],"names":[],"mappings":"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","sourcesContent":["import get from 'lodash/get';\nimport { IBuyTogetherComponentData, IProductOrderBump } from '../buy-together.type';\nimport { IProductCard } from '../../../components';\nimport {\n  Attribute,\n  Product,\n  BuyTogether as IBuyTogether,\n  ShowcaseColor,\n  Payment,\n} from '@uxshop/storefront-core/dist/modules/buy-together/BuyTogetherTypes';\nimport { ISelectVariation } from '../../ui/product-card/product-card.type';\nimport { checkHasBalance, checkIsOutReleaseDate } from '../buy-together.utils';\nimport { ReleaseDate } from '@uxshop/storefront-core/dist/types/ReleaseDateTypes';\n\ntype AttributesExtraDataType = {\n  balance: number;\n  releaseDate: ReleaseDate;\n  isSellOutOfStock?: boolean;\n};\n\nexport class FrontBuyTogetherAdapter {\n  static isFirstLoad = false;\n  static placeholderDisabled = { name: 'Selecione', disabled: true, value: undefined };\n  public static adapterIBuyTogetherToComponentData(\n    buyTogether: IBuyTogether,\n    isFirstLoad = false,\n  ): IBuyTogetherComponentData {\n    this.isFirstLoad = isFirstLoad;\n    const componentData = {\n      productMain: this.adapterToProductCard(buyTogether.product),\n      products: buyTogether.productsPivot.map(data => this.adapterPivotToProductCard(data)),\n      originalData: buyTogether,\n    };\n    this.isFirstLoad = false;\n    return componentData;\n  }\n\n  public static adapterPivotToProductCard(product: Product): IProductOrderBump {\n    return {\n      ...this.adapterToProductCard(product),\n      isCheck: true,\n    };\n  }\n\n  public static adapterToProductCard(product: Product): IProductCard {\n    const adaptSpecialPrice = (payments: Payment[]): number | null => {\n      const pixMethod = payments.find(payment => payment.method === 'pix');\n      if (pixMethod) {\n        const specialPrice = Number(pixMethod.installment.total);\n        return specialPrice;\n      }\n      return null;\n    };\n    adaptSpecialPrice(product.payments);\n    const { price, priceCompare, id } = this.getValuesByVariation(product);\n    return {\n      price,\n      priceBase: priceCompare,\n      id,\n      productId: product.productId,\n      image: product.images?.length ? product.images[0] : { src: '' },\n      name: product.name,\n      slug: product.slug,\n      selectVariations: this.adapterAttributes(product),\n      specialPrice: adaptSpecialPrice(product.payments),\n    };\n  }\n\n  public static getValuesByVariation(product: Product) {\n    const { attribute, attributeSecondary, color } = product;\n    const filter = {\n      'attribute.id': attribute?.id,\n      'attributeSecondary.id': attributeSecondary?.id,\n      'color.id': color?.id,\n    };\n    const variationsFiltered = this.filterVariations(product.variations, filter);\n    return variationsFiltered[0] || product;\n  }\n\n  public static adapterAttributes(product: Product): ISelectVariation[] {\n    const colors: ISelectVariation = this.generateSelectColors(product);\n    const attributes = this.generateSelectAttributes(product);\n    const attributesSecondary = this.generateSelectAttributesSecondary(product);\n    return [colors, attributes, attributesSecondary].filter(attr => !!attr);\n  }\n\n  public static generateSelectAttributes(product: Product): ISelectVariation {\n    const { color, attributeSecondary, isSellOutOfStock } = product;\n    const filterToCompare = {\n      'color.id': color?.id,\n      'attributeSecondary.id': attributeSecondary?.id,\n    };\n    const productVariations = product.color\n      ? this.filterVariations(product.variations, filterToCompare, 'attribute')\n      : product.variations;\n    const attributes = this.filterAttributesByUnique(productVariations, 'attribute');\n    if (!attributes.length) return null;\n    return {\n      placeholder: this.placeholderDisabled,\n      label: product.attribute?.attributeName,\n      options: attributes.map(({ balance, id, name, releaseDate }) => ({\n        name,\n        value: id,\n        disabled: this.checkAttributeOptionDisabled({ balance, releaseDate, isSellOutOfStock }),\n      })),\n      selectType: 'attributes',\n      currentValue: this.isFirstLoad ? undefined : product.attribute?.id,\n    };\n  }\n\n  public static generateSelectAttributesSecondary(product: Product): ISelectVariation {\n    const { color, attribute, isSellOutOfStock } = product;\n    const filterToCompare = { 'color.id': color?.id, 'attribute.id': attribute?.id };\n    const listAttributesSecondary = this.filterAttributesByUnique(\n      this.filterVariations(product.variations, filterToCompare, 'attributeSecondary'),\n      'attributeSecondary',\n    );\n    if (!listAttributesSecondary.length) return null;\n    return {\n      placeholder: this.placeholderDisabled,\n      label: product.attributeSecondary?.attributeName,\n      options: listAttributesSecondary.map(({ name, balance, id, releaseDate }) => ({\n        value: id,\n        name,\n        disabled: this.checkAttributeOptionDisabled({ balance, releaseDate, isSellOutOfStock }),\n      })),\n      selectType: 'secondaryAttributes',\n      currentValue: this.isFirstLoad ? undefined : product.attributeSecondary?.id,\n    };\n  }\n\n  public static generateSelectColors(product: Product): ISelectVariation {\n    const listColors = this.filterAttributesByUnique(product.variations, 'color');\n    if (!listColors?.length) return null;\n    return {\n      label: 'Cor',\n      placeholder: this.placeholderDisabled,\n      options: listColors?.map(({ balance, id, name, releaseDate }) => ({\n        name,\n        value: id,\n        disabled: this.checkAttributeOptionDisabled({ balance, releaseDate }),\n      })),\n      currentValue: product.color?.id,\n      selectType: 'color',\n    };\n  }\n\n  private static filterVariations(\n    variations: Product[],\n    filter: { [key: string]: any },\n    attributeTarget?: keyof Product,\n  ) {\n    const filterKeys = Object.keys(filter);\n    return variations.filter(objVariation => {\n      const hasAttr = !attributeTarget || !!objVariation[attributeTarget];\n      if (!hasAttr) return false;\n      return filterKeys.reduce((acc, currentKey) => {\n        const valueForCompare = filter[currentKey];\n        const value = get(objVariation, currentKey);\n        return acc && value === valueForCompare;\n      }, true);\n    });\n  }\n\n  public static filterAttributesByUnique(\n    attributesGeneric: Product[],\n    attributeTarget: keyof Product,\n  ) {\n    return attributesGeneric\n      .filter(attr => !!attr[attributeTarget])\n      .reduce(\n        (acc, current) => {\n          const objItem = current[attributeTarget] as Attribute | ShowcaseColor;\n          const index = acc.findIndex(attrAcc => attrAcc.id === objItem.id);\n          if (index === -1)\n            return [\n              ...acc,\n              { ...objItem, balance: current.balance, releaseDate: current.releaseDate },\n            ];\n          return acc;\n        },\n        [] as ((Attribute | ShowcaseColor) & AttributesExtraDataType)[],\n      );\n  }\n\n  private static checkAttributeOptionDisabled(data: AttributesExtraDataType) {\n    const { balance, releaseDate, isSellOutOfStock } = data;\n    return (\n      !checkHasBalance({ balance, isSellOutOfStock }) || !checkIsOutReleaseDate({ releaseDate })\n    );\n  }\n}\n"]}