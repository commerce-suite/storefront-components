{"file":"live-shop.entry.cjs.js","mappings":";;;;;;;;MAOa,eAAe;IAGlB,MAAM,WAAW;QACvB,MAAM,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,IAAI,OAAO,CAAC,SAAS,CAAC,CAAC;QAChF,OAAO,MAAMA,oBAAc,CAAC,OAAO,CAAC;YAClC,MAAM,EAAE,CAAC,MAAM,EAAE,gBAAgB,EAAE,OAAO,EAAE,cAAc,EAAE,WAAW,EAAE,MAAM,CAAC;YAChF,MAAM,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,EAAE,KAAK,EAAE,UAAU,CAAC,MAAM,EAAE;SAC1D,CAAC,CAAC;KACJ;IAED,MAAM,WAAW,CAAC,QAAgB;QAChC,IAAI,CAAC,YAAY,GAAG,MAAMC,qBAAe,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAC9D,OAAO,IAAI,CAAC,YAAY,CAAC;KAC1B;IAED,MAAM,sBAAsB;;QAC1B,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,EAAE,CAAC;QAC1C,MAAM,YAAY,GAAG,MAAA,IAAI,CAAC,YAAY,0CAAE,QAAQ,CAAC;QACjD,OAAO,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,EAAE;;YACjC,MAAM,WAAW,GAAG,YAAY,CAAC,IAAI,CAAC,OAAO,IAAI,OAAO,CAAC,SAAS,KAAK,IAAI,CAAC,SAAS,CAAC,CAAC;YACvF,MAAM,MAAM,GAAG,MAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,MAAM,mCAAI,IAAI,CAAC;YAC3C,OAAO;gBACL,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS;gBACnB,IAAI,EAAE,IAAI,CAAC,IAAI;gBACf,KAAK,EAAE,MAAC,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,MAAM,0CAAG,CAAC,CAAY,mCAAI,IAAI;gBAC5C,KAAK,EAAE,IAAI,CAAC,KAAK;gBACjB,SAAS,EAAE,IAAI,CAAC,YAAY;gBAC5B,KAAK,EAAE,EAAE;gBACT,OAAO,EAAE,EAAE;gBACX,IAAI,EAAE,SAAS;gBACf,IAAI,EAAE,IAAI,CAAC,IAAI;gBACf,IAAI,EAAE,MAAM,IAAI,MAAM,KAAK,QAAQ;gBACnC,SAAS,EAAE,MAAM,KAAK,cAAc;aACrC,CAAC;SACH,CAAC,CAAC;KACJ;IAED,sBAAsB;QACpB,OAAO,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO;;YAAI,QAAC;gBAChD,EAAE,EAAE,MAAA,OAAO,CAAC,EAAE,mCAAI,IAAI;gBACtB,KAAK,EAAE,OAAO,CAAC,KAAK;gBACpB,OAAO,EAAE,OAAO,CAAC,OAAO;gBACxB,IAAI,EAAE,SAAS;gBACf,IAAI,EAAE,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM,KAAK,QAAQ;gBACnD,SAAS,EAAE,OAAO,CAAC,MAAM,KAAK,cAAc;aAC7C,EAAC;SAAA,CAAC,CAAC;KACL;IAED,WAAW,CAAC,KAA2B,EAAE,OAAsB;QAC7D,MAAM,YAAY,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI;YACjC,IAAI,IAAI,CAAC,EAAE,KAAK,OAAO,CAAC,EAAE,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,CAAC,IAAI,EAAE;gBACxD,uCACK,IAAI,KACP,IAAI,EAAE,OAAO,CAAC,MAAM,KAAK,QAAQ,EACjC,SAAS,EAAE,OAAO,CAAC,MAAM,KAAK,cAAc,IAC5C;aACH;YACD,OAAO,IAAI,CAAC;SACb,CAAC,CAAC;QAEH,OAAO,YAAY,CAAC;KACrB;IAED,MAAM,QAAQ;QACZ,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,sBAAsB,EAAE,CAAC;QACzD,MAAM,YAAY,GAAG,IAAI,CAAC,sBAAsB,EAAE,CAAC;QACnD,OAAO,CAAC,GAAG,YAAY,EAAE,GAAG,YAAY,CAAC,CAAC;KAC3C;;;MC3EU,eAAe;IAY1B,YAAY,GAAW;QANf,WAAM,GAAqB,IAAI,CAAC;QAChC,sBAAiB,GAAG,CAAC,CAAC;QACtB,qBAAgB,GAAkB,IAAI,CAAC;QAEvC,oBAAe,GAA2C,IAAI,CAAC;QAqB/D,WAAM,GAAG;YACf,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC;YAE3B,IAAI,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,MAAM,EAAE;gBACvC,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;aAC/D;SACF,CAAC;QAEK,YAAO,GAAG,CAAC,KAAiB;YACjC,IAAI,CAAC,KAAK,CAAC,QAAQ;gBAAE,IAAI,CAAC,eAAe,EAAE,CAAC;SAC7C,CAAC;QAEM,YAAO,GAAG;YAChB,IAAI,CAAC,eAAe,EAAE,CAAC;SACxB,CAAC;QAhCA,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,OAAO,EAAE,CAAC;KAChB;IAEO,OAAO;QACb,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC;YAC3B,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC;YAC3B,IAAI,CAAC,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC;SAC9B;QAED,IAAI,CAAC,MAAM,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAEtC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QACjC,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;QACnC,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;KACpC;IAkBO,eAAe;QACrB,IAAI,IAAI,CAAC,gBAAgB,KAAK,IAAI;YAAE,OAAO;QAE3C,IAAI,IAAI,CAAC,iBAAiB,IAAI,eAAe,CAAC,sBAAsB;YAAE,OAAO;QAE7E,MAAM,KAAK,GACT,IAAI,CAAC,iBAAiB,KAAK,CAAC;cACxB,eAAe,CAAC,uBAAuB;cACvC,IAAI,CAAC,GAAG,CACN,eAAe,CAAC,uBAAuB,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC,EACjF,eAAe,CAAC,mBAAmB,CACpC,CAAC;QAER,IAAI,CAAC,gBAAgB,GAAG,MAAM,CAAC,UAAU,CAAC;YACxC,IAAI,CAAC,iBAAiB,EAAE,CAAC;YACzB,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;YAC7B,IAAI,CAAC,OAAO,EAAE,CAAC;SAChB,EAAE,KAAK,CAAC,CAAC;KACX;IAEM,eAAe;;QACpB,IAAI,CAAA,MAAA,IAAI,CAAC,MAAM,0CAAE,UAAU,MAAK,SAAS,CAAC,IAAI,EAAE;YAC9C,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;SACrB;QACD,IAAI,IAAI,CAAC,gBAAgB,KAAK,IAAI,EAAE;YAClC,YAAY,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACpC,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;SAC9B;KACF;IAEM,SAAS,CAAC,QAAuC;QACtD,IAAI,CAAC,eAAe,GAAG,QAAQ,CAAC;QAChC,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;SACnD;KACF;;AAjFuB,sCAAsB,GAAG,CAAH,CAAK;AAC3B,uCAAuB,GAAG,IAAH,CAAQ;AAC/B,mCAAmB,GAAG,KAAH,CAAS;AAC5B,uCAAuB,GAAG,IAAH;;ACJjD,MAAM,WAAW,GAAG,qpFAAqpF,CAAC;AAC1qF,uBAAe,WAAW;;MCWb,QAAQ;;;;;QAiBX,iBAAY,GAAG;YACrB,IAAI,CAAC,aAAa,GAAG,MAAM,CAAC,UAAU,IAAI,IAAI,CAAC;SAChD,CAAC;QAEM,sBAAiB,GAAG;YAC1B,IAAI,CAAC,UAAU,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC;SACpC,CAAC;QAEM,kBAAa,GAAG,CAAC,KAA2B;YAClD,IAAI;gBACF,IAAI,CAAC,KAAK,CAAC,IAAI;oBAAE,OAAO;gBAExB,MAAM,OAAO,GAAkB,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBAEtD,MAAM,SAAS,GAA2B;oBACxC,MAAM,EAAE,QAAQ;oBAChB,OAAO,EAAE,UAAU;iBACpB,CAAC;gBAEF,IAAI,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;oBAC3B,IAAI,CAAC,gBAAgB,mCAAQ,IAAI,CAAC,gBAAgB,KAAE,MAAM,EAAE,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,GAAE,CAAC;oBACtF,OAAO;iBACR;gBAED,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;aACzF;YAAC,OAAO,KAAK,EAAE;gBACd,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;aACtB;SACF,CAAC;;gCA3CmC,KAAK;;6BAER,MAAM,CAAC,UAAU,IAAI,IAAI;0BAC5B,KAAK;yBACN,IAAI;;;;;;IAyClC,oBAAoB;QAClB,MAAM,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;QACxD,IAAI,IAAI,CAAC,UAAU;YAAE,IAAI,CAAC,UAAU,CAAC,eAAe,EAAE,CAAC;KACxD;IAED,MAAM,gBAAgB;;QACpB,IAAI;YACF,IAAI,CAAC,IAAI,CAAC,QAAQ;gBAAE,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;YAC7D,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;YACrD,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC;YAC9B,IAAI,CAAC,oBAAoB,GAAG,IAAI,eAAe,EAAE,CAAC;YAClD,IAAI,CAAC,gBAAgB,GAAG,MAAM,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACnF,IAAI,CAAC,IAAI,CAAC,gBAAgB;gBAAE,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;YACnE,IAAI,CAAC,aAAa,GAAG,MAAM,IAAI,CAAC,oBAAoB,CAAC,QAAQ,EAAE,CAAC;YAChE,IAAI,IAAI,CAAC,gBAAgB,EAAE;gBACzB,IAAI,CAAC,OAAO,GAAGC,2BAAqB,CAAC,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;aACrE;YACD,MAAM,SAAS,GAAwB,qBAAqB,CAAC;YAC7D,IAAI,CAAC,UAAU,GAAG,IAAI,eAAe,CAAC,GAAG,SAAS,aAAa,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;YAChF,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;SAC/C;QAAC,OAAO,KAAK,EAAE;YACd,IAAI,MAAA,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,OAAO,0CAAE,QAAQ,CAAC,qBAAqB,CAAC,EAAE;gBACnD,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;gBAC7B,OAAO,CAAC,KAAK,CAAC,qBAAqB,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;gBAChD,OAAO;aACR;YACD,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;SACtB;gBAAS;YACR,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;SACxB;KACF;IAEO,aAAa;QACnB,QACEC,mBAAK,KAAK,EAAC,mBAAmB,IAC5BA,oBAAM,KAAK,EAAC,SAAS,GAAG,CACpB,EACN;KACH;IAEO,YAAY;;QAClB,QACEA,mBAAK,KAAK,EAAC,kBAAkB,IAC3BA,2BAAa,WAAW,EAAC,qBAAqB,EAAC,SAAS,EAAE,IAAI,CAAC,gBAAgB,CAAC,KAAK,IAClF,CAAA,MAAA,IAAI,CAAC,gBAAgB,CAAC,MAAM,0CAAE,GAAG,KAChCA,mBAAK,GAAG,EAAE,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,GAAG,GAAI,IACnF,IAAI,CACI,CACV,EACN;KACH;IAEO,YAAY;QAClB,OAAO,IAAI,CAAC,aAAa,IACvBA,gCACE,OAAO,EAAE,IAAI,CAAC,OAAO,EACrB,YAAY,EAAE,IAAI,CAAC,gBAAgB,EACnC,KAAK,EAAE,IAAI,CAAC,aAAa,GACP,KAEpBA,iCACE,OAAO,EAAE,IAAI,CAAC,OAAO,EACrB,YAAY,EAAE,IAAI,CAAC,gBAAgB,EACnC,KAAK,EAAE,IAAI,CAAC,aAAa,EACzB,UAAU,EAAE,IAAI,CAAC,UAAU,EAC3B,UAAU,EAAE,MAAM,IAAI,CAAC,iBAAiB,EAAE,GAC1C,CACH,CAAC;KACH;IAEO,cAAc;QACpB,QACEA,mBAAK,KAAK,EAAC,oBAAoB,IAC7BA,2BACE,WAAW,EAAC,qBAAqB,EACjC,SAAS,EAAC,uBAAuB,EACjC,eAAe,EAAC,kEAA6D,IAE7EA,sBAAQ,OAAO,EAAE,MAAM,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,wCAAuC,CAC5E,CACV,EACN;KACH;IAED,MAAM;;QACJ,IAAI,IAAI,CAAC,SAAS,EAAE;YAClB,OAAOA,UAACC,YAAI,QAAE,IAAI,CAAC,aAAa,EAAE,CAAQ,CAAC;SAC5C;QAED,IAAI,IAAI,CAAC,gBAAgB,EAAE;YACzB,OAAOD,mCAAqB,cAAc,EAAE,MAAM,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,GAAI,CAAC;SAClF;QAED,QACEA,UAACC,YAAI,QACHD,mBAAK,KAAK,EAAC,WAAW,IACnB,CAAA,MAAA,IAAI,CAAC,gBAAgB,0CAAE,MAAM,MAAK,QAAQ,IAAI,IAAI,CAAC,YAAY,EAAE,EACjE,CAAA,MAAA,IAAI,CAAC,gBAAgB,0CAAE,MAAM,MAAK,QAAQ,IAAI,IAAI,CAAC,YAAY,EAAE,EACjE,CAAA,MAAA,IAAI,CAAC,gBAAgB,0CAAE,MAAM,MAAK,UAAU,IAAI,IAAI,CAAC,cAAc,EAAE,CAClE,CACD,EACP;KACH;;;;;;","names":["ProductService","LiveShopService","extractYouTubeVideoId","h","Host"],"sources":["src/components/live-shop/services/live-shop.service.ts","src/services/WebSocketClient.ts","src/components/live-shop/live-shop.scss?tag=live-shop","src/components/live-shop/live-shop.tsx"],"sourcesContent":["import { LiveShopService, ProductService } from '@uxshop/storefront-core';\nimport { LiveShop } from '@uxshop/storefront-core/dist/modules/live-shop/LiveShopTypes';\nimport { IHighlightCardItem } from '../../../components';\nimport { IImage } from '../../ui/product-card/product-card.type';\nimport { IMessageItem, IProductItem } from '../../ui/highlight-card/highlight-card.type';\nimport { SocketMessage } from '../live-shop.type';\n\nexport class LiveShopHandler {\n  private liveShopData: LiveShop;\n\n  private async getProducts() {\n    const productIds = this.liveShopData.products.map(product => product.productId);\n    return await ProductService.getList({\n      fields: ['name', 'images { src }', 'price', 'priceCompare', 'productId', 'slug'],\n      filter: { productIds, page: 0, first: productIds.length },\n    });\n  }\n\n  async getLiveShop(hashRoom: string): Promise<LiveShop> {\n    this.liveShopData = await LiveShopService.getByHash(hashRoom);\n    return this.liveShopData;\n  }\n\n  async productsToItemsAdapter(): Promise<IProductItem[]> {\n    const products = await this.getProducts();\n    const liveProducts = this.liveShopData?.products;\n    return products.edges.map(({ node }) => {\n      const liveProduct = liveProducts.find(product => product.productId === node.productId);\n      const status = liveProduct?.status ?? null;\n      return {\n        id: +node.productId,\n        name: node.name,\n        image: (node?.images?.[0] as IImage) ?? null,\n        price: node.price,\n        priceBase: node.priceCompare,\n        title: '',\n        content: '',\n        type: 'product',\n        slug: node.slug,\n        show: status && status !== 'hidden',\n        highlight: status === 'highlighting',\n      };\n    });\n  }\n\n  messagesToItemsAdapter(): IMessageItem[] {\n    return this.liveShopData.messages.map(message => ({\n      id: message.id ?? null,\n      title: message.title,\n      content: message.content,\n      type: 'message',\n      show: message.status && message.status !== 'hidden',\n      highlight: message.status === 'highlighting',\n    }));\n  }\n\n  updateItems(items: IHighlightCardItem[], message: SocketMessage): IHighlightCardItem[] {\n    const updatedItems = items.map(item => {\n      if (item.id === message.id && item.type === message.type) {\n        return {\n          ...item,\n          show: message.status !== 'hidden',\n          highlight: message.status === 'highlighting',\n        };\n      }\n      return item;\n    });\n\n    return updatedItems;\n  }\n\n  async getItems(): Promise<IHighlightCardItem[]> {\n    const productItems = await this.productsToItemsAdapter();\n    const messageItems = this.messagesToItemsAdapter();\n    return [...productItems, ...messageItems];\n  }\n}\n","export class WebSocketClient {\n  private static readonly MAX_RECONNECT_ATTEMPTS = 5;\n  private static readonly INITIAL_RECONNECT_DELAY = 5000;\n  private static readonly MAX_RECONNECT_DELAY = 30000;\n  private static readonly INITIAL_INCREMENT_DELAY = 1000;\n\n  private socket: WebSocket | null = null;\n  private reconnectAttempts = 0;\n  private reconnectTimeout: number | null = null;\n  private url: string;\n  private messageCallback: ((event: MessageEvent) => void) | null = null;\n\n  constructor(url: string) {\n    this.url = url;\n    this.connect();\n  }\n\n  private connect() {\n    if (this.socket) {\n      this.socket.onclose = null;\n      this.socket.onerror = null;\n      this.socket.onmessage = null;\n    }\n\n    this.socket = new WebSocket(this.url);\n\n    this.socket.onopen = this.onOpen;\n    this.socket.onclose = this.onClose;\n    this.socket.onerror = this.onError;\n  }\n\n  private onOpen = () => {\n    this.reconnectAttempts = 0;\n\n    if (this.messageCallback && this.socket) {\n      this.socket.addEventListener('message', this.messageCallback);\n    }\n  };\n\n  public onClose = (event: CloseEvent) => {\n    if (!event.wasClean) this.handleReconnect();\n  };\n\n  private onError = () => {\n    this.handleReconnect();\n  };\n\n  private handleReconnect() {\n    if (this.reconnectTimeout !== null) return;\n\n    if (this.reconnectAttempts >= WebSocketClient.MAX_RECONNECT_ATTEMPTS) return;\n\n    const delay =\n      this.reconnectAttempts === 0\n        ? WebSocketClient.INITIAL_INCREMENT_DELAY\n        : Math.min(\n            WebSocketClient.INITIAL_RECONNECT_DELAY * Math.pow(2, this.reconnectAttempts - 1),\n            WebSocketClient.MAX_RECONNECT_DELAY,\n          );\n\n    this.reconnectTimeout = window.setTimeout(() => {\n      this.reconnectAttempts++;\n      this.reconnectTimeout = null;\n      this.connect();\n    }, delay);\n  }\n\n  public closeConnection() {\n    if (this.socket?.readyState === WebSocket.OPEN) {\n      this.socket.close();\n    }\n    if (this.reconnectTimeout !== null) {\n      clearTimeout(this.reconnectTimeout);\n      this.reconnectTimeout = null;\n    }\n  }\n\n  public onMessage(callback: (event: MessageEvent) => void) {\n    this.messageCallback = callback;\n    if (this.socket) {\n      this.socket.addEventListener('message', callback);\n    }\n  }\n}\n","@import '../../style/mixins/button.scss';\n@import '../../style/mixins/spinner-loading.scss';\n\n:host {\n  display: block;\n  width: 100%;\n}\n\n.loading-container {\n  display: flex;\n  width: 100%;\n  justify-content: center;\n  align-items: center;\n  min-height: 350px;\n\n  .spinner {\n    @include lds-dual-ring;\n  }\n}\n\n.live-shop {\n  &-warmup {\n    .banner-custom-style {\n      padding: 40px;\n\n      > .custom-card-content {\n        width: 100%;\n        max-width: 720px;\n        height: auto;\n        aspect-ratio: 16 / 9;\n\n        & img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        }\n\n        .live-shop-banner {\n          background-color: #d9d9d9;\n          height: 100%;\n          width: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n      }\n    }\n  }\n\n  &-finished {\n    .button-custom-style {\n      padding: 40px;\n      max-width: 410px;\n      margin: 0 auto;\n      text-align: center;\n\n      & button {\n        @include front-button;\n        font-weight: 500;\n        font-size: 14px;\n      }\n    }\n  }\n}\n","import { Component, Event, Host, EventEmitter, h, State, Prop, Env } from '@stencil/core';\nimport { ILiveShop, SocketMessage } from './live-shop.type';\nimport { IHighlightCardItem } from '../../components';\nimport { LiveShopHandler } from './services/live-shop.service';\nimport { WebSocketClient } from '../../services/WebSocketClient';\nimport { extractYouTubeVideoId } from '../../utils/utils';\n\n@Component({\n  tag: 'live-shop',\n  styleUrl: 'live-shop.scss',\n  shadow: false,\n})\nexport class LiveShop {\n  @Prop() hashRoom: string;\n  @State() liveShopNotFound: boolean = false;\n  @State() videoId: string;\n  @State() isSmallDevice: boolean = window.innerWidth <= 1024;\n  @State() isChatOpen: boolean = false;\n  @State() isLoading: boolean = true;\n  @State() liveShopRegister: ILiveShop;\n  @State() liveShopItemsService: LiveShopHandler;\n  @State() liveShopItems: IHighlightCardItem[];\n  @State() liveSocket: WebSocketClient;\n\n  @Event({ bubbles: true, eventName: 'on-return-to-home' })\n  onReturnToHome: EventEmitter<void>;\n\n  @Event() componentRendered: EventEmitter<void>;\n\n  private handleResize = () => {\n    this.isSmallDevice = window.innerWidth <= 1024;\n  };\n\n  private isChatOpenHandler = () => {\n    this.isChatOpen = !this.isChatOpen;\n  };\n\n  private handleMessage = (event: MessageEvent<string>) => {\n    try {\n      if (!event.data) return;\n\n      const message: SocketMessage = JSON.parse(event.data);\n\n      const statusMap: Record<string, string> = {\n        liveOn: 'inLive',\n        liveOff: 'finished',\n      };\n\n      if (statusMap[message.type]) {\n        this.liveShopRegister = { ...this.liveShopRegister, status: statusMap[message.type] };\n        return;\n      }\n\n      this.liveShopItems = this.liveShopItemsService.updateItems(this.liveShopItems, message);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  disconnectedCallback() {\n    window.removeEventListener('resize', this.handleResize);\n    if (this.liveSocket) this.liveSocket.closeConnection();\n  }\n\n  async componentDidLoad() {\n    try {\n      if (!this.hashRoom) throw new Error('Hash Room is required');\n      this.isLoading = true;\n      window.addEventListener('resize', this.handleResize);\n      this.componentRendered.emit();\n      this.liveShopItemsService = new LiveShopHandler();\n      this.liveShopRegister = await this.liveShopItemsService.getLiveShop(this.hashRoom);\n      if (!this.liveShopRegister) throw new Error('live-shop_not_found');\n      this.liveShopItems = await this.liveShopItemsService.getItems();\n      if (this.liveShopRegister) {\n        this.videoId = extractYouTubeVideoId(this.liveShopRegister.urlLive);\n      }\n      const wsBaseUrl = Env.WEBSOCKET_URL || 'ws://localhost:3001';\n      this.liveSocket = new WebSocketClient(`${wsBaseUrl}?hashRoom=${this.hashRoom}`);\n      this.liveSocket.onMessage(this.handleMessage);\n    } catch (error) {\n      if (error?.message?.includes('live-shop_not_found')) {\n        this.liveShopNotFound = true;\n        console.error('Live Shop not found', { error });\n        return;\n      }\n      console.error(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private renderLoading() {\n    return (\n      <div class=\"loading-container\">\n        <span class=\"spinner\" />\n      </div>\n    );\n  }\n\n  private renderWarmup() {\n    return (\n      <div class=\"live-shop-warmup\">\n        <custom-card customClass=\"banner-custom-style\" cardTitle={this.liveShopRegister.title}>\n          {this.liveShopRegister.banner?.src ? (\n            <img src={this.liveShopRegister.banner.src} alt={this.liveShopRegister.banner.alt} />\n          ) : null}\n        </custom-card>\n      </div>\n    );\n  }\n\n  private renderInLive() {\n    return this.isSmallDevice ? (\n      <live-shop-mobile\n        videoId={this.videoId}\n        liveShopData={this.liveShopRegister}\n        items={this.liveShopItems}\n      ></live-shop-mobile>\n    ) : (\n      <live-shop-desktop\n        videoId={this.videoId}\n        liveShopData={this.liveShopRegister}\n        items={this.liveShopItems}\n        isChatOpen={this.isChatOpen}\n        toggleChat={() => this.isChatOpenHandler()}\n      />\n    );\n  }\n\n  private renderFinished() {\n    return (\n      <div class=\"live-shop-finished\">\n        <custom-card\n          customClass=\"button-custom-style\"\n          cardTitle=\"A live chegou ao fim!\"\n          cardDescription=\"Fique de olho em nossas próximas lives para mais novidades!\"\n        >\n          <button onClick={() => this.onReturnToHome.emit()}>Voltar para a página inicial</button>\n        </custom-card>\n      </div>\n    );\n  }\n\n  render() {\n    if (this.isLoading) {\n      return <Host>{this.renderLoading()}</Host>;\n    }\n\n    if (this.liveShopNotFound) {\n      return <live-shop-not-found onReturnToHome={() => this.onReturnToHome.emit()} />;\n    }\n\n    return (\n      <Host>\n        <div class=\"live-shop\">\n          {this.liveShopRegister?.status === 'warmup' && this.renderWarmup()}\n          {this.liveShopRegister?.status === 'inLive' && this.renderInLive()}\n          {this.liveShopRegister?.status === 'finished' && this.renderFinished()}\n        </div>\n      </Host>\n    );\n  }\n}\n"],"version":3}